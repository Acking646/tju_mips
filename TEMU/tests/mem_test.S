# 目标：测试访存指令 lw, sw, lb, sb

#include "trap.h"
.set noat
.text
.globl main

main:
    # === 测试1: sw/lw (32位读写) ===
    # 设置测试基地址
    lui $s7, 0x8000
    ori $s7, $s7, 0x2000      # $s7 = 0x80002000
    
    # 准备测试数据
    lui $t0, 0x1234
    ori $t0, $t0, 0x5678      # $t0 = 0x12345678
    sw $t0, 0($s7)            # 存储32位到地址 0x80002000
    lw $t1, 0($s7)            # 从地址 0x80002000 加载32位
    # 如果实现正确，$t1 应该等于 $t0 (0x12345678)
    
    # === 测试2: sb/lb (8位符号扩展 - 负数) ===
    ori $t2, $zero, 0xFF      # $t2 = 0xFF
    sb $t2, 4($s7)            # 存储字节 0xFF 到地址 0x80002004
    lb $t3, 4($s7)            # 加载字节（应该符号扩展到 0xFFFFFFFF）
    # 如果实现正确，$t3 应该等于 0xFFFFFFFF
    
    # === 测试3: sb/lb (8位符号扩展 - 正数) ===
    ori $t4, $zero, 0x7F      # $t4 = 0x7F
    sb $t4, 5($s7)            # 存储字节 0x7F 到地址 0x80002005
    lb $t5, 5($s7)            # 加载字节（应该符号扩展到 0x0000007F）
    # 如果实现正确，$t5 应该等于 0x0000007F
    
    # === 测试4: sb 部分写入 ===
    lui $t6, 0xABCD
    ori $t6, $t6, 0x1234      # $t6 = 0xABCD1234
    sw $t6, 8($s7)            # 存储32位到地址 0x80002008
    ori $t7, $zero, 0xAA      # $t7 = 0xAA
    sb $t7, 8($s7)            # 只修改低8位为 0xAA
    lw $t8, 8($s7)            # 读取32位
    # 如果实现正确，$t8 的低8位应该是 0xAA，高24位保持不变
    
    # === 测试5: 多个地址的读写 ===
    lui $s0, 0x0000
    ori $s0, $s0, 0x1111      # $s0 = 0x1111
    sw $s0, 12($s7)           # 存储到地址 0x8000200C
    lui $s1, 0x0000
    ori $s1, $s1, 0x2222      # $s1 = 0x2222
    sw $s1, 16($s7)           # 存储到地址 0x80002010
    lw $s2, 12($s7)           # 读取地址 0x8000200C
    lw $s3, 16($s7)           # 读取地址 0x80002010
    # 如果实现正确，$s2 = 0x1111, $s3 = 0x2222
    
    # 如果运行到这里，且寄存器值正确，说明访存指令实现正确
    ori $s4, $zero, 1         # $s4 = 1 表示成功
    HIT_GOOD_TRAP

#include "trap.h"
.set noat
.set noreorder
.globl main
.text
main:
    # ==============================
    # 测试 1: sll 逻辑左移
    # ==============================
    addiu $t0, $zero, 1         # $t0 = 1
    sll $t1, $t0, 0             # $t1 = 1 (移位0位)
    sll $t2, $t0, 1             # $t2 = 2
    sll $t3, $t0, 4             # $t3 = 16
    sll $t4, $t0, 8             # $t4 = 256
    sll $t5, $t0, 16            # $t5 = 0x00010000
    sll $t6, $t0, 31            # $t6 = 0x80000000 (最高位)
    
    # ==============================
    # 测试 2: sra 算术右移 (符号扩展)
    # ==============================
    lui $s0, 0x8000             # $s0 = 0x80000000 (符号位=1)
    sra $s1, $s0, 1             # $s1 = 0xC0000000 (高位补1)
    sra $s2, $s0, 4             # $s2 = 0xF8000000
    sra $s3, $s0, 8             # $s3 = 0xFF800000
    sra $s4, $s0, 16            # $s4 = 0xFFFF8000
    sra $s5, $s0, 31            # $s5 = 0xFFFFFFFF
    
    # ==============================
    # 测试 3: 正数算术右移 (高位补0)
    # ==============================
    addiu $s6, $zero, 0x7FFFFFFF  # $s6 = 0x7FFFFFFF (符号位=0)
    sra $s7, $s6, 1             # $s7 = 0x3FFFFFFF
    sra $t7, $s6, 16            # $t7 = 0x00007FFF
    
    # ==============================
    # 测试 4: 移位组合运算
    # ==============================
    addiu $v0, $zero, 1         # $v0 = 1
    sll $v0, $v0, 4             # $v0 = 16
    sra $v0, $v0, 2             # $v0 = 4 (16 >> 2 = 4)
    
    # ==============================
    # 测试 5: 边界值移位测试
    # ==============================
    addiu $v1, $zero, 0xFF      # $v1 = 255
    sll $a0, $v1, 24            # $a0 = 0xFF000000
    sra $a1, $a0, 24            # $a1 = 0xFFFFFFFF (符号扩展)
    
    # 验证算术右移结果
    addiu $a2, $zero, 0xFF      # $a2 = 255
    bne $a1, $a2, fail          # 检查符号扩展是否正确
    nop
    
    HIT_GOOD_TRAP

fail:
    b fail
    nop